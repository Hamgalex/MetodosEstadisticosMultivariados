%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Do not alter this block of commands.  If you're proficient at LaTeX, you may include additional packages, create macros, etc. immediately below this block of commands, but make sure to NOT alter the header, margin, and comment settings here. 
\documentclass[12pt]{article}
 \usepackage[margin=1in]{geometry} 
\usepackage{amsmath,amsthm,amssymb,amsfonts, enumitem, fancyhdr, color, comment, graphicx, environ}
\pagestyle{fancy}
\setlength{\headheight}{65pt}
\newenvironment{problem}[2][Problema]{\begin{trivlist}
\item[\hskip \labelsep {\bfseries #1}\hskip \labelsep {\bfseries #2.}]}{\end{trivlist}}
\newenvironment{sol}
    {\emph{Solución:}
    }
    {
    }
\specialcomment{com}{ \color{blue} \textbf{Comment:} }{\color{black}} %for instructor comments while grading
\NewEnviron{probscore}{\marginpar{ \color{blue} \tiny Problem Score: \BODY \color{black} }}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Fill in the appropriate information below
\lhead{Héctor Alejandro Márquez González}  %replace with your name
\rhead{Métodos Estadísticos Multivariados \\ 1989936} %replace XYZ with the homework course number, semester (e.g. ``Spring 2019"), and assignment number.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Do not alter this block.
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}{1}
Considera un vector aleatorio $\mathbf{X}$ con distribución $N_5(\mathbf{\mu,\Sigma})$ donde:
\begin{align*}
\mathbf{\mu}' = (100,95,230,400,86), \quad \mathbf{\Sigma}=
\begin{bmatrix}
10 & -2 & 1 & 0 & 3 \\
-2 & 9 & -3 & 4 & 5 \\
1 & -3 & 15 & 7 & -2 \\
0 & 4 & 7 & 20 & 2 \\
3 & 5 & -2 & 2 & 5
\end{bmatrix}
\end{align*}
a) Obtener $P(90<X_2<100)$. b) Obtener $P(3X_1+4X_3-5X_5>800)$ \\
c) Sea el vector aleatorio:
\begin{align*}
\mathbf{Y}= \begin{bmatrix}
X_1+3X_2-4X_3+6X_4+X_5\\
2X_1+9X_2-10X_3+X_4-X_5\\
X_2+X_4-X_5
\end{bmatrix}
\end{align*}
Obtener la distribución de $\mathbf{Y}$\\
d) Obtener la distancia estadística de $\mathbf{X_1}'(110, 97, 230, 396, 85)$ a $\mathbf{X_2}'(96, 93, 237, 408, 90)$.\\
e) Indicar que componentes de $\mathbf{\bar{X}}$ son independientes.\\
\end{problem}
\begin{sol}a)Obtener $P(90<X_2<100)$.\\
Debido a que el vector aleatorio $\mathbf{X}$ sigue una distribución normal multivariada, entonces $X_i$ sigue una distribución normal, por tanto para calcular esta probabilidad observamos que: $\mu_2=95$ y $\sigma_{22}=9$. Usaremos código en R para calcular la probabilidad:\\ \\
\includegraphics[width=1\textwidth]{img/1.png}\\\\
Por tanto $P(90<X_2<100) = 0.9044$

\pagebreak

b)Obtener $P(3X_1+4X_3-5X_5>800)$.\\
Las combinaciones lineales de los componentes de $\mathbf{X}$ tienen distribución normal, esto es $N(\mathbf{a' \mu,a' \Sigma a})$
\begin{align*}
\begin{pmatrix}
3 & 0 & 4 & 0 & -5
\end{pmatrix} \mathbf{X} = 3X_1+4X_3-5X_5
\end{align*}
Calcularemos $\mathbf{a' \mu}$ y $\mathbf{a' \Sigma a}$ en R: \\\\
\includegraphics[width=1\textwidth]{img/2.png}\\\\
Ahora , para calcular la probabilidad sabemos que: $P(3X_1+4X_3-5X_5>800) = 1 - P(3X_1+4X_3-5X_5<800)$:\\\\
\includegraphics[width=1\textwidth]{img/3.png}\\\\
Por tanto, $P(3X_1+4X_3-5X_5>800)=0.3222$

\pagebreak

c) Obtener la distribución de $\mathbf{Y}$\\
Tenemos a $\mathbf{A}$:
\begin{align*} \mathbf{A} =
\begin{pmatrix}
1 & 3 & -4 & 6 & 1 \\
2 & 9 & -10 & 1 & -1\\
0 & 1 & 0 & 1 & -1 
\end{pmatrix}
\end{align*}
Sabemos que si $\mathbf{X}$ sigue una normal multivariada, entonces  $q$ combinaciones lineales sigue una distribución $N_q(\mathbf{A \mu , A \Sigma A'})$. Calcularemos estas operaciones en R:\\\\
\includegraphics[width=1\textwidth]{img/4.png}\\\\
Por tanto, la distribución de $\mathbf{Y}$ es:
\begin{align*}
\mathbf{Y}\sim N_3(\begin{pmatrix}
1951 \\ -931 \\ 409
\end{pmatrix}, 
\begin{pmatrix}
992 & 943 & 129 \\
943 & 2508 & 22 \\
129 & 22 & 28
\end{pmatrix})
\end{align*}

\pagebreak
d) Obtener la distancia estadística de $\mathbf{x_1}'(110, 97, 230, 396, 85)$ a $\mathbf{x_2}'(96, 93, 237, 408, 90)$. \\\\
Primero calcularemos  \(\mathbf{X_1} - \mathbf{X_2}\):
\begin{align*}
\mathbf{x_1} - \mathbf{x_2} &= (110 - 96, 97 - 93, 230 - 237, 396 - 408, 85 - 90) \\
\mathbf{x_1} - \mathbf{x_2}&= (14, 4, -7, -12, -5).
\end{align*}
Ahora calcularemos la inversa de $\mathbf{\Sigma}$ con R: \\\\
\includegraphics[width=1\textwidth]{img/5.png}\\\\
Por tanto:
\begin{align*}
\mathbf{\Sigma}^{-1} = \begin{bmatrix}
  0.5421 &  0.6879 & -0.0190 & -0.0300 & -1.0088 \\
  0.6879 &  1.1591 &  0.0229 & -0.0870 & -1.5279 \\
 -0.0190 &  0.0229 &  0.0990 & -0.0438 &  0.0457 \\
 -0.0300 & -0.0870 & -0.0438 &  0.0771 &  0.0567 \\
 -1.0088 & -1.5279 &  0.0457 &  0.0567 &  2.3288
\end{bmatrix}
\end{align*}
Ahora calcularemos la distancia con $d^2(\mathbf{x_1,x_2})=(\mathbf{x_1-x_2})\mathbf{\Sigma}^{-1}(\mathbf{x_1-x_2})'$ con R:\\\\
\includegraphics[width=1\textwidth]{img/6.png}\\\\
Por tanto la distancia estadística de $\mathbf{x_1}'(110, 97, 230, 396, 85)$ a $\mathbf{x_2}'(96, 93, 237, 408, 90)$ es de $22.4033$ 

\pagebreak

e) Indicar que componentes de $\mathbf{\bar{X}}$ son independientes.\\ 
En $\mathbf{\Sigma}$ tenemos que $\sigma_{14} = \sigma_{41} = 0$ y esta es la unica covarianza cero en la matriz de covarianzas poblacionales, esto sumado a que en una distribución normal multivariada la covarianza cero implica que los componentes correspondientes son independientes nos dice que los únicos componentes que son independientes son $\mathbf{X_1}$ y $\mathbf{X_4}$.
\end{sol}

\pagebreak

\begin{problem}{2}
Considerando el problema 1, se toma una muestra aleatoria de tamaño 40.\\
a) Obtener $P(\bar{X_3}<229)$. b) Obtener $P(4\bar{X_1}+3\bar{X_3}-\bar{X_4}<687)$.\\
c) Obtener la distancia estadística de $\bar{X}'=(99.5,96,231,400,86.2)$ a $\mathbf{\mu}$. \\
d) Obtener la distribución de $\mathbf{W}= \begin{bmatrix}
\bar{X_1} + 2\bar{X_3}-\bar{X_4} \\
\bar{X_2}+\bar{X_5}
\end{bmatrix}$
\end{problem}

\begin{sol}
a) Obtener $P(\bar{X_3}<229)$.\\
Debido a que $\mathbf{X_i}$ tiene distribución $N_5(\mathbf{\mu,\Sigma})$ entonces  $\mathbf{\bar{X}}$ tiene distribución $N_5(\mathbf{\mu,\frac{1}{40}\Sigma})$, calcularemos $\frac{1}{40}\Sigma)$ en R:\\\\
\includegraphics[width=1\textwidth]{img/7.png}
\begin{align*}
\frac{\mathbf{\Sigma}}{40} = \begin{bmatrix}
  0.250 & -0.050 &  0.025 & 0.000 &  0.075 \\
 -0.050 &  0.225 & -0.075 & 0.100 &  0.125 \\
  0.025 & -0.075 &  0.375 & 0.175 & -0.050 \\
  0.000 &  0.100 &  0.175 & 0.500 &  0.050 \\
  0.075 &  0.125 & -0.050 & 0.050 &  0.125
\end{bmatrix}
\end{align*}
Debido a que esta es la matriz de covarianzas de $\bar{X}$ entonces $\bar{X_3}$ tiene varianza $\sigma_{33}=0.375$. También tenemos que $\mu_3=230$, usaremos estos datos para calcular la probabilidad en R: \\\\
\includegraphics[width=1\textwidth]{img/8.png}\\\\
Por tanto $P(\bar{X_3}<229)=0.0512$ \pagebreak

b)Obtener $P(4\bar{X_1}+3\bar{X_3}-\bar{X_4}<687)$.\\
Del ejercicio anterior sabemos que $\mathbf{\bar{X}} \sim N_5(\mathbf{\mu},\frac{\Sigma}{40})$. Tenemos la combinación lineal de\\ $\mathbf{a'\bar{X}}= \begin{pmatrix}
4\\0\\3\\-1\\0
\end{pmatrix}\mathbf{\bar{X}}$. Sabemos que la combinación lineal de los componentes de  $\mathbf{\bar{X}}$ tiene distribución normal $N(\mathbf{a' \mu, a' \frac{\Sigma}{40} a})$.
Calcularemos $\mathbf{a' \mu}$ y $\mathbf{a' \Sigma a}$ en R: \\\\
\includegraphics[width=1\textwidth]{img/9.png}\\\\
Ahora calcularemos la probabilidad:\\\\
\includegraphics[width=1\textwidth]{img/10.png}\\\\
Por tanto,  $P(4\bar{X_1}+3\bar{X_3}-\bar{X_4}<687)=0.1354$

\pagebreak

c) Obtener la distancia estadística de $\bar{X}'=(99.5,96,231,400,86.2)$ a $\mathbf{\mu}$. \\
Primero calcularemos $\mathbf{\bar{x}'}-\mathbf{\mu}$:
\begin{align*}
(\mathbf{\bar{x}'}-\mathbf{\mu})' &= \begin{pmatrix}
-0.5 & 1 & 1 & 0 & 0.2
\end{pmatrix}
\end{align*}
Ahora calcularemos la distancia con $d^2(\mathbf{x_1,x_2})=(\mathbf{x_1-x_2})\frac{\mathbf{\Sigma}^{-1}}{40}(\mathbf{x_1-x_2})'$ con R:\\\\
\includegraphics[width=1\textwidth]{img/11.png}\\\\
Por tanto la distancia estadística de $\mathbf{x_1}'(99.5,96,231,400,86.2)$ a $\mathbf{\mu}$ es de $4.3477$ 

\pagebreak

d) Obtener la distribución de $\mathbf{W}= \begin{bmatrix}
\bar{X_1} + 2\bar{X_3}-\bar{X_4} \\
\bar{X_2}+\bar{X_5}
\end{bmatrix}$\\
Tenemos a A:
\begin{align*}\mathbf{A}=
\begin{pmatrix}
1 & 0 & 2 & -1 & 0\\
0 & 1 & 0 & 0 & 1
\end{pmatrix}
\end{align*}
abemos que si $\mathbf{\bar{X}}$ sigue una normal multivariada, entonces  $q$ combinaciones lineales sigue una distribución $N_q(\mathbf{A \mu , A \frac{\Sigma}{40} A'})$. Calcularemos estas operaciones en R:\\\\
\includegraphics[width=1\textwidth]{img/12.png}\\\\
Por tanto, la distribución de $\mathbf{W}$ es:
\begin{align*}
\mathbf{W}\sim N_2(\begin{pmatrix}
160\\181
\end{pmatrix}, 
\begin{pmatrix}
1.650 & -0.375 \\
-0.375 & 0.600
\end{pmatrix})
\end{align*}
\end{sol}

\pagebreak

\begin{problem}{3}
Aplicar la prueba de ajuste en R a una distribución normal multivariada a los datos del excel.
\end{problem}

\begin{sol}
Para probar la normalidad multivariada de un conjunto de datos nos basaremos en las distancias generalizadas al cuadrado:
\begin{align*}
d_i^2=(\mathbf{X_i-\bar{X}})'\mathbf{S}^{-1}(\mathbf{X_i-\bar{X}})
\end{align*}
Debido a que $n=50$ y $p=4$ entonces cada una de las distancias al cuadrado debe seguir una distribución chi cuadrada. A continuación evaluaremos el ajuste a través de QQ-plots de $d_i^2$ vs $\chi_p^2$ mediante R, usando la función  mahalanobis para acelerar el proceso de sacar todas las distancias y la función qchisq para sacar los cuantiles de la distribución chi cuadrado con 4 grados de libertad. Luego graficaremos estos datos con la función qqplot.
\\\\
\includegraphics[width=1\textwidth]{img/13.png}
\includegraphics[width=1\textwidth]{img/14.png}
Debido a que los cuantiles teóricos y los cuantiles muestrales se alinean a la línea de referencia, entonces la distribución de distancias se aproxima a la chi cuadrada con 4 grados de libertad. Esto quiere decir que el conjunto de datos tiene una distribución normal multivariante.
\end{sol}

\pagebreak

El código hecho en R lo puede encontrar en:\\ https://github.com/Hamgalex/MetodosEstadisticosMultivariados/blob/main/T3/T3.R
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Do not alter anything below this line.
\end{document}